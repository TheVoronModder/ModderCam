# ModderCam â€” Klipper Macros (Jinja2-safe)
[gcode_macro MODDERCAM_VARS]
variable_moddercam_host: "localhost"
variable_moddercam_http_port: 8090
variable_moddercam_ws_port: 8091
gcode:
  M118 ModderCam vars loaded

[gcode_shell_command moddercam_start]
command: sudo systemctl start moddercam
timeout: 10.0
verbose: True

[gcode_shell_command moddercam_stop]
command: sudo systemctl stop moddercam
timeout: 10.0
verbose: True

[gcode_shell_command moddercam_restart]
command: sudo systemctl restart moddercam
timeout: 20.0
verbose: True

[gcode_shell_command moddercam_status]
command: systemctl is-active moddercam || true
timeout: 5.0
verbose: True

[gcode_shell_command moddercam_snapshot]
command: bash ~/printer_data/config/ModderCam/scripts/snapshot.sh
timeout: 20.0
verbose: True

[gcode_macro MODDERCAM_ON]
gcode:
  RUN_SHELL_COMMAND CMD=moddercam_start
  RESPOND TYPE=command MSG="action:notification title=ModderCam text=Started"
  SET_DISPLAY_TEXT MSG="ModderCam: started"

[gcode_macro MODDERCAM_OFF]
gcode:
  RUN_SHELL_COMMAND CMD=moddercam_stop
  RESPOND TYPE=command MSG="action:notification title=ModderCam text=Stopped"
  SET_DISPLAY_TEXT MSG="ModderCam: stopped"

[gcode_macro MODDERCAM_RESTART]
gcode:
  RUN_SHELL_COMMAND CMD=moddercam_restart
  RESPOND TYPE=command MSG="action:notification title=ModderCam text=Restarted"
  SET_DISPLAY_TEXT MSG="ModderCam: restarted"

[gcode_macro MODDERCAM_STATUS]
gcode:
  RUN_SHELL_COMMAND CMD=moddercam_status
  RESPOND TYPE=command MSG="action:notification title=ModderCam text=Check console for status"
  SET_DISPLAY_TEXT MSG="ModderCam: status requested"

[gcode_macro MODDERCAM_URL]
gcode:
  {% set host = printer['gcode_macro MODDERCAM_VARS'].moddercam_host %}
  {% set http_port = printer['gcode_macro MODDERCAM_VARS'].moddercam_http_port %}
  RESPOND TYPE=command MSG="action:notification title=ModderCam text=http://{{host}}:{{http_port}}/"
  M118 URL: http://{{host}}:{{http_port}}/

[gcode_macro MODDERCAM_SNAPSHOT]
gcode:
  RUN_SHELL_COMMAND CMD=moddercam_snapshot
  RESPOND TYPE=command MSG="action:notification title=ModderCam text=Snapshot saved (see console)"
  SET_DISPLAY_TEXT MSG="ModderCam: snapshot saved"
